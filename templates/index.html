<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CyberScan Neon</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/static/style.css">
</head>
<body class="dark">
<div class="bg-grid"></div>

<nav class="navbar navbar-dark px-4 py-3 nav-glow">
  <a class="navbar-brand text-neon fw-bold" href="#">üõ°Ô∏è CyberScan</a>
  <div>
    <a class="btn btn-outline-light btn-sm me-2" href="#">GitHub ‚òÖ</a>
  </div>
</nav>

<header class="container text-center my-4">
  <h1 class="hero animate__animated animate__fadeInDown">CyberScan <span class="text-gradient">URL Detector</span></h1>
  <p class="sub animate__animated animate__fadeInUp">Scan your URL and check your result ‚Äî fast, clear, and flashy.</p>
</header>

<main class="container">
  <div class="row gx-4 align-items-start">
    <div class="col-lg-6">

      <!-- URL Scan Card -->
      <div class="card glass p-4 shadow-lg animate__animated animate__zoomIn">
        <h4 class="fw-bold mb-3 text-neon">Enter URL</h4>
        <form id="scanForm">
          <div class="input-group mb-3 neon-input-group">
            <input id="urlInput" type="text" class="form-control bg-dark text-light neon-input" placeholder="üîó Paste your URL here..." required>
            <button class="btn btn-accent" type="submit">Scan</button>
          </div>
        </form>

        <!-- Loader Bars -->
        <div class="d-flex justify-content-center my-3">
          <div class="loader-bars" id="loaderBars" style="display:none;">
            <div class="bar b1"></div>
            <div class="bar b2"></div>
            <div class="bar b3"></div>
            <div class="bar b4"></div>
            <div class="bar b5"></div>
          </div>
        </div>

        <!-- Spinner + Typing -->
        <div id="loader" class="d-none text-center mt-3">
          <div class="cyber-spinner"></div>
          <div class="typing mt-2" id="typingText"></div>
        </div>
      </div>

      <!-- Bulk Scan Card -->
      <div class="card glass p-3 mt-4 animate__animated animate__fadeInUp">
        <h5 class="text-neon">Bulk Scan</h5>
        <form action="/bulk" method="post" enctype="multipart/form-data">
          <input type="file" name="csvfile" accept=".csv" class="form-control mb-2">
          <button class="btn btn-outline-accent btn-sm">Upload CSV & Scan</button>
        </form>
        <p class="mt-2 small">Tip: CSV should have one URL per line.</p>
      </div>

    </div>

    <div class="col-lg-6">
      <!-- Result Card -->
      <div id="resultCard" class="card glass p-4 shadow-lg animate__animated" style="display:none;">
        <div class="d-flex justify-content-between">
          <h4 class="fw-bold text-neon">Scan Result</h4>
          <div>
            <button class="btn btn-sm btn-light me-2" id="copyBtn">Copy</button>
            <a id="qrLink" class="btn btn-sm btn-light" target="_blank">QR</a>
          </div>
        </div>
        <div class="mt-3 d-flex align-items-center">
          <div class="score-box me-4">
            <div id="scoreBig" class="score-big">0</div>
            <div class="score-label">Threat Score</div>
          </div>
          <div class="flex-fill">
            <div class="meter">
              <div id="meterBar" class="meter-bar"></div>
            </div>
            <p class="mt-2"><strong id="labelText" class="text-gradient">Label</strong> ‚Ä¢ Score: <span id="scoreText">0</span></p>
          </div>
        </div>
        <ul id="reasonsList" class="list-group list-group-flush bg-transparent mt-3"></ul>
        <div class="mt-3">
          <a class="btn btn-success btn-lg" id="shareBtn">Share Result</a>
        </div>
        <p class="mt-3 small text-muted">Scan your URL and check your result.</p>
      </div>
    </div>

  </div>
</main>

<footer class="text-center py-4 text-muted">
  <small class="typing-footer" id="footerTyping"></small>
</footer>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
function typeText(el, text, speed=40){
  el.innerHTML='';
  let i=0;
  const t = setInterval(()=>{
    el.innerHTML += text.charAt(i);
    i++;
    if(i>=text.length) clearInterval(t);
  }, speed);
}

function showLoaderBars(show){
  const lb = document.getElementById('loaderBars');
  lb.style.display = show ? 'flex' : 'none';
}

document.getElementById('scanForm').addEventListener('submit', function(e){
  e.preventDefault();
  const url = document.getElementById('urlInput').value.trim();
  if(!url) return;

  document.getElementById('loader').classList.remove('d-none');
  showLoaderBars(true);
  typeText(document.getElementById('typingText'), 'Analyzing URL: ' + url, 20);

  // Try backend POST
  $.post('/share', {url: url}, function(res){
    showResult(res);
  }).fail(()=>{
    // Dummy fallback
    showResult({
      url: url,
      label: 'Safe',
      score: 15,
      reasons: ['No suspicious indicators found']
    });
  });
});

function showResult(res){
  document.getElementById('loader').classList.add('d-none');
  showLoaderBars(false);

  $('#resultCard').show().addClass('animate__animated animate__flipInX');
  $('#labelText').text(res.label);
  $('#scoreText').text(res.score);
  $('#scoreBig').text(res.score);

  let pct = Math.min(100, res.score*2.5 + 10);
  $('#meterBar').css('width', pct+'%').removeClass().addClass('meter-bar '+
    (res.label==='Likely Phishing' ? 'danger' : (res.label==='Suspicious' ? 'warn' : 'safe'))
  );

  const rl = $('#reasonsList').empty();
  if(res.reasons && res.reasons.length){
    res.reasons.forEach(r=> rl.append('<li class="list-group-item bg-transparent text-light small">'+r+'</li>'));
  } else {
    rl.append('<li class="list-group-item bg-transparent text-light small">No suspicious indicators found.</li>');
  }

  $('#qrLink').attr('href','/qrcode?url='+encodeURIComponent(res.url));
  $('#copyBtn').off('click').on('click', ()=>{
    navigator.clipboard.writeText(JSON.stringify(res)).then(()=> alert('Result copied to clipboard'));
  });
  $('#shareBtn').off('click').on('click', ()=>{
    const shareUrl = location.origin+'/?u='+encodeURIComponent(res.url);
    navigator.clipboard.writeText(shareUrl).then(()=> alert('Share link copied: '+shareUrl));
  });
}

document.addEventListener('DOMContentLoaded', ()=>{
  typeText(document.getElementById('footerTyping'), '‚ö° CyberScan ‚Äì Making the web safer, one scan at a time.', 40);
});
</script>
</body>
</html>
