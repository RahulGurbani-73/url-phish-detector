<!doctype html>
<html lang="en">
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <title>Bulk Results - CyberScan Neon</title>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css' rel='stylesheet'>
    <link rel='stylesheet' href='/static/style.css'>
  </head>
  <body class='dark'>
    <div class='container py-5'>
      <h3 class='text-light mb-3'>Bulk Scan Results</h3>
      <div class='mb-3'>
        <strong>Summary:</strong>
        <span class='badge bg-success'>Safe: {{ summary['Likely Safe'] }}</span>
        <span class='badge bg-warning text-dark'>Suspicious: {{ summary['Suspicious'] }}</span>
        <span class='badge bg-danger'>Phishing: {{ summary['Likely Phishing'] }}</span>
        <span class='badge bg-secondary'>Invalid: {{ summary['Invalid'] }}</span>
      </div>
      <div class='mb-3'>
        <label class='me-2 text-light'>Filter:</label>
        <select id='filter' class='form-select d-inline-block w-auto'>
          <option value='all'>All</option>
          <option value='Likely Safe'>Likely Safe</option>
          <option value='Suspicious'>Suspicious</option>
          <option value='Likely Phishing'>Likely Phishing</option>
        </select>
        <a class='btn btn-outline-success btn-sm ms-3' onclick='downloadCSV()'>Export All</a>
      </div>
      <table id='resultsTable' class='table table-dark table-striped'>
        <thead><tr><th>URL</th><th>Score</th><th>Label</th><th>Reasons</th></tr></thead>
        <tbody>
        {% for r in results %}
          <tr data-label='{{ r.label }}'>
            <td>{{ r.url }}</td>
            <td>{{ r.score }}</td>
            <td>{{ r.label }}</td>
            <td>{{ '; '.join(r.reasons) }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    <script>
      document.getElementById('filter').addEventListener('change', function(){
        const val = this.value;
        const rows = document.querySelectorAll('#resultsTable tbody tr');
        rows.forEach(r=>{
          if(val==='all' || r.dataset.label===val) r.style.display='';
          else r.style.display='none';
        });
      });
      function downloadCSV(){
        let csv = 'URL,Score,Label,Reasons\n';
        const rows = document.querySelectorAll('#resultsTable tbody tr');
        rows.forEach(r=>{
          if(r.style.display==='none') return;
          const cols = r.querySelectorAll('td');
          const line = [cols[0].innerText, cols[1].innerText, cols[2].innerText, cols[3].innerText.replace(/,/g,';')].join(',');
          csv += line + '\n';
        });
        const blob = new Blob([csv], {type: 'text/csv'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download='bulk-results.csv'; a.click();
        URL.revokeObjectURL(url);
      }
    </script>
  </body>
</html>
